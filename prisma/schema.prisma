// 1. Configuración del generador
generator client {
  provider = "prisma-client-js"
}

// 2. ✅ AGREGA ESTA SECCIÓN DE DATASOURCE (FALTABA)
datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// 3. ENUM para los perfiles
enum UserRole {
  VECINO
  COMERCIANTE
  PROFESIONAL
}

// 4. MODELO User
model User {
  id                   String               @id @default(uuid())
  createdAt            DateTime             @default(now())
  updatedAt            DateTime             @updatedAt
  email                String               @unique
  nombre               String
  apellido             String
  passwordHash         String
  role                 UserRole             @default(VECINO)
  passwordResetTokens  PasswordResetToken[]
  comercianteProfile   ComercianteProfile?
  profesionalProfile   ProfesionalProfile?
}

// 5. MODELO PasswordResetToken
model PasswordResetToken {
  id        String   @id @default(uuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

// 6. MODELO ComercianteProfile - ACTUALIZADO
model ComercianteProfile {
  id            String   @id @default(cuid())
  userId        String   @unique
  usuario       String   @unique  // ✅ USERNAME ALEATORIO
  instagram     String?  // ✅ NUEVO: Instagram opcional
  nombreNegocio String
  categoria     String
  descripcion   String
  direccion     String
  telefono      String
  aprobado      Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  logoUrl       String?

  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// 7. MODELO ProfesionalProfile - ACTUALIZADO
model ProfesionalProfile {
  id              String   @id @default(cuid())
  userId          String   @unique
  usuario         String   @unique  // ✅ USERNAME ALEATORIO
  instagram       String?  // ✅ NUEVO: Instagram opcional
  nombreServicio  String
  categoria       String
  descripcion     String
  experiencia     String
  zonaCobertura   String
  telefono        String
  disponibilidad  String
  aprobado        Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  logoUrl         String?

  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}
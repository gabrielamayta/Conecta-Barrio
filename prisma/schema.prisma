// 1. Configuración del generador
generator client {
  provider = "prisma-client-js"
}

// 2. Configuración de la base de datos (SQLite)
datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// 3. ENUM para los perfiles
enum UserRole {
  VECINO
  COMERCIANTE
  PROFESIONAL
}

// 4. MODELO User
model User {
  id                  String                @id @default(uuid())
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  email               String                @unique
  nombre              String
  apellido            String
  passwordHash        String
  role                UserRole              @default(VECINO)
  passwordResetTokens PasswordResetToken[]
  comercianteProfile  ComercianteProfile?
  profesionalProfile  ProfesionalProfile?
}

// 5. MODELO PasswordResetToken
model PasswordResetToken {
  id        String   @id @default(uuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

// 6. MODELO ComercianteProfile
model ComercianteProfile {
  id            String   @id @default(cuid())
  userId        String   @unique
  usuario       String   @unique
  instagram     String?
  nombreNegocio String
  categoria     String
  descripcion   String
  direccion     String
  telefono      String
  aprobado      Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  logoUrl       String?

  // Relaciones
  user          User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  imagenes      GaleriaImagen[] // <-- Esto conecta con la galería
}

// 7. MODELO ProfesionalProfile
model ProfesionalProfile {
  id              String   @id @default(cuid())
  userId          String   @unique
  usuario         String   @unique
  instagram       String?
  nombreServicio  String
  categoria       String
  descripcion     String
  experiencia     String
  zonaCobertura   String
  telefono        String
  disponibilidad  String
  aprobado        Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  logoUrl         String?

  // Relaciones
  user            User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  imagenes        GaleriaImagen[] // <-- Esto conecta con la galería
}

// 8. MODELO GaleriaImagen
model GaleriaImagen {
  id            String   @id @default(cuid())
  url           String   // Ejemplo: /uploads/foto123.png
  comercioId    String?
  profesionalId String?
  createdAt     DateTime @default(now())

  // Relaciones inversas
  comerciante   ComercianteProfile? @relation(fields: [comercioId], references: [id], onDelete: Cascade)
  profesional   ProfesionalProfile? @relation(fields: [profesionalId], references: [id], onDelete: Cascade)
}